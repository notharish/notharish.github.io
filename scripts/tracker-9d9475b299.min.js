window.CONFIG={CLIENT_ID:"209191307792-57cp00mia6fgfc7dj0ohbbgqqtfu45q4.apps.googleusercontent.com",SHEET_ID:"1t73pb_DWXW5hBySNJeIjrkve72pVTae1iaYCj-MMBog",WEIGHT_SHEET:"Sheet1",SCOPES:"https://www.googleapis.com/auth/spreadsheets"},(()=>{var i={accessToken:null,gapiLoaded:!1,tokenClient:null};function e(){return new Promise(function(e,t){i.gapiLoaded&&gapi.client?e():window.gapi&&gapi.load?gapi.load("client",function(){gapi.client.init({discoveryDocs:["https://sheets.googleapis.com/$discovery/rest?version=v4"]}).then(function(){i.gapiLoaded=!0,e()}).catch(t)}):t(new Error("gapi not loaded"))})}function t(){return new Promise(function(t,n){try{var e=(()=>{if(!i.tokenClient){if(!window.google||!google.accounts||!google.accounts.oauth2)throw new Error("Google Identity Services not available");i.tokenClient=google.accounts.oauth2.initTokenClient({client_id:window.CONFIG&&window.CONFIG.CLIENT_ID,scope:window.CONFIG&&window.CONFIG.SCOPES,callback:function(){}})}return i.tokenClient})();e.callback=function(e){e&&e.access_token?(i.accessToken=e.access_token,t(e.access_token)):n(new Error("No access token"))},e.requestAccessToken({prompt:""})}catch(e){n(e)}})}function n(){t().then(e).then(function(){gapi.client.setToken({access_token:i.accessToken}),document.dispatchEvent(new CustomEvent("tracker:auth:ready",{detail:{token:i.accessToken}}))}).catch(function(e){console.error(e)})}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("googleSignInBtn");e&&e.addEventListener("click",n)}),window.TrackerAuth={getToken:function(){return i.accessToken}}})(),(()=>{var n=window.CONFIG&&window.CONFIG.SHEET_ID||"",i=(window.CONFIG&&window.CONFIG.WEIGHT_SHEET||"Sheet1")+"!A:B";window.TrackerSheets={readLastEntry:function(){return gapi.client.sheets.spreadsheets.values.get({spreadsheetId:n,range:i,majorDimension:"ROWS"}).then(function(e){var t=e&&e.result&&e.result.values||[];if(t.length)for(var n=t.length-1;0<=n;n--){var i=t[n];if(i&&2<=i.length&&i[0]&&i[1])return{dateTime:i[0],weight:parseFloat(i[1])}}return{dateTime:null,weight:null}})},appendEntry:function(e){var t=(new Date).toISOString();return gapi.client.sheets.spreadsheets.values.append({spreadsheetId:n,range:i,valueInputOption:"USER_ENTERED",insertDataOption:"INSERT_ROWS",resource:{values:[[t,e]]}}).then(function(){return{ok:!0,weight:e,dateTime:t}})}}})(),(()=>{var n={},i={weight:null,prevWeight:null,dateTime:null};function e(e){return document.getElementById(e)}function a(e,t){n.status&&(n.status.textContent=e,n.status.className="alert "+("error"===t?"alert-danger":"alert-success"),n.status.style.display="block",setTimeout(function(){n.status.style.display="none"},2e3))}function o(){null!==i.weight&&(n.currentWeight.textContent=i.weight.toFixed(1),n.input.value=i.weight.toFixed(1));var e=null;null===(e=null!==i.weight&&null!==i.prevWeight?i.weight-i.prevWeight:e)||isNaN(e)?(n.weightDifference.textContent="â€”",n.weightDifference.style.color="#666"):0<e?(n.weightDifference.textContent="+"+e.toFixed(1)+" lbs",n.weightDifference.style.color="#e74c3c"):e<0?(n.weightDifference.textContent=e.toFixed(1)+" lbs",n.weightDifference.style.color="#27ae60"):(n.weightDifference.textContent="No change",n.weightDifference.style.color="#666"),i.dateTime&&(n.lastDate.textContent="Last updated: "+new Date(i.dateTime).toLocaleString())}function t(){n.auth&&(n.auth.style.display="none"),n.main&&(n.main.style.display="block"),window.TrackerSheets.readLastEntry().then(function(e){i.prevWeight=e.weight,i.weight=e.weight,i.dateTime=e.dateTime,o()}).catch(function(){a("Failed to load last entry","error")})}function r(){var t=parseFloat(n.input.value);isNaN(t)||t<=0?a("Enter a valid weight","error"):(i.prevWeight=i.weight,window.TrackerSheets.appendEntry(t).then(function(e){i.weight=t,i.dateTime=e.dateTime,o(),a("Saved!","success")}).catch(function(){a("Save failed","error")}))}document.addEventListener("DOMContentLoaded",function(){n.auth=e("authSection"),n.main=e("mainSection"),n.currentWeight=e("currentWeight"),n.weightDifference=e("weightDifference"),n.lastDate=e("lastDate"),n.input=e("weightInput"),n.save=e("saveBtn"),n.status=e("statusMessage"),n.save&&n.save.addEventListener("click",r),document.addEventListener("tracker:auth:ready",t)})})();