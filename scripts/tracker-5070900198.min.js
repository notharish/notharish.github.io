window.CONFIG={CLIENT_ID:"209191307792-57cp00mia6fgfc7dj0ohbbgqqtfu45q4.apps.googleusercontent.com",SHEET_ID:"1t73pb_DWXW5hBySNJeIjrkve72pVTae1iaYCj-MMBog",TRACKER_SHEET:"Sheet3",SCOPES:"https://www.googleapis.com/auth/spreadsheets"},(()=>{var a={accessToken:null,gapiLoaded:!1,tokenClient:null};function e(){return new Promise(function(e,t){a.gapiLoaded&&gapi.client?e():window.gapi&&gapi.load?gapi.load("client",function(){gapi.client.init({discoveryDocs:["https://sheets.googleapis.com/$discovery/rest?version=v4"]}).then(function(){a.gapiLoaded=!0,e()}).catch(t)}):t(new Error("gapi not loaded"))})}function t(){return new Promise(function(t,n){try{var e=(()=>{if(!a.tokenClient){if(!window.google||!google.accounts||!google.accounts.oauth2)throw new Error("Google Identity Services not available");a.tokenClient=google.accounts.oauth2.initTokenClient({client_id:window.CONFIG&&window.CONFIG.CLIENT_ID,scope:window.CONFIG&&window.CONFIG.SCOPES,callback:function(){}})}return a.tokenClient})();e.callback=function(e){e&&e.access_token?(a.accessToken=e.access_token,t(e.access_token)):n(new Error("No access token"))},e.requestAccessToken({prompt:""})}catch(e){n(e)}})}function n(){t().then(e).then(function(){gapi.client.setToken({access_token:a.accessToken}),document.dispatchEvent(new CustomEvent("tracker:auth:ready",{detail:{token:a.accessToken}}))}).catch(function(e){console.error(e)})}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("googleSignInBtn");e&&e.addEventListener("click",n)}),window.TrackerAuth={getToken:function(){return a.accessToken}}})(),(()=>{var i=window.CONFIG&&window.CONFIG.SHEET_ID||"",c=window.CONFIG&&window.CONFIG.TRACKER_SHEET||"Sheet3",u=["Date","Number","Text"],d=null;function l(e,t){if(null==e||""===e)return!1;switch(t){case"Date":return!isNaN(Date.parse(e));case"Number":return!isNaN(parseFloat(e))&&isFinite(e);case"Text":return"string"==typeof e||"number"==typeof e;default:return!1}}function p(e){if(!e||0===e.length)return"Text";for(var t=!1,n=!1,a=0;a<Math.min(e.length,10);a++){var r,o=e[a];null!=o&&""!==o&&("number"!=typeof o||isNaN(o)?"string"==typeof o?/^\d{4}-\d{2}-\d{2}$/.test(o)?(r=new Date(o),isNaN(r.getTime())?0:t=!0):!isNaN(parseFloat(o))&&isFinite(o)?n=!0:0:o instanceof Date&&!isNaN(o.getTime())?t=!0:0:n=!0)}return t?"Date":n?"Number":"Text"}function e(){return d?Promise.resolve(d):gapi.client.sheets.spreadsheets.values.get({spreadsheetId:i,range:c+"!1:1",majorDimension:"ROWS"}).then(function(e){var l=e.result&&e.result.values&&e.result.values[0]||[];if(0===l.length)throw new Error("No headers found in sheet");if("Date"!==l[0])throw new Error('First column must be "Date"');e=c+"!A2:"+String.fromCharCode(65+l.length-1)+"10";return gapi.client.sheets.spreadsheets.values.get({spreadsheetId:i,range:e,majorDimension:"ROWS"}).then(function(e){for(var t=e.result&&e.result.values||[],n={},a=0;a<l.length;a++){for(var r=l[a],o=[],s=0;s<t.length;s++)o.push(t[s][a]);var i=p(o);n[r]={index:a,type:i,supported:u.includes(i)}}return d={columns:n,headers:l,dateColumn:"Date"}})})}window.TrackerSheets={readLastEntry:function(){return e().then(function(u){return gapi.client.sheets.spreadsheets.values.get({spreadsheetId:i,range:c+"!A2:Z",majorDimension:"ROWS"}).then(function(e){var t=e&&e.result&&e.result.values||[];if(0===t.length)return{date:null,data:{}};for(var n=null,a=t.length-1;0<=a;a--){var r=t[a];if(r&&0<r.length&&r[0]){n=r;break}}if(!n)return{date:null,data:{}};var o,s={date:n[0],data:{}};for(o in u.columns){var i=u.columns[o],l=n[i.index];void 0!==l&&""!==l&&("Number"===i.type?s.data[o]=parseFloat(l):(i.type,s.data[o]=l))}return s})})},appendEntry:function(s){return e().then(function(e){for(var t in s)if("Date"!==t){var n=e.columns[t];if(!n)throw new Error("Unknown column: "+t);if(!n.supported)throw new Error("Unsupported column type: "+t+" ("+n.type+")");if(!l(s[t],n.type))throw new Error("Invalid data for column "+t+": expected "+n.type)}var a=new Array(e.headers.length);a[0]=(new Date).toISOString().split("T")[0];for(var r=1;r<e.headers.length;r++){var o=e.headers[r],o=s[o]||"";a[r]=o}return gapi.client.sheets.spreadsheets.values.append({spreadsheetId:i,range:c+"!A:Z",valueInputOption:"USER_ENTERED",insertDataOption:"INSERT_ROWS",resource:{values:[a]}}).then(function(){return{ok:!0,date:a[0],data:s}})})},getColumnMetadata:e,validateData:l,inferColumnType:p}})(),(()=>{var s={},i={date:null,data:{}},l=null,u={};function e(e){return document.getElementById(e)}function o(e,t){s.status.textContent=e,s.status.className="alert "+("error"===t?"alert-danger":"alert-success"),s.status.style.display="block",setTimeout(function(){s.status.style.display="none"},3e3)}function n(e){l=e,s.formContainer.innerHTML="";for(var t=e.headers,n=e.columns,a=1;a<t.length;a++){var r=t[a],o=n[r];o&&o.supported&&(o=((e,t,n)=>{var a=document.createElement("div"),r=(a.className="form-group",document.createElement("label")),o=(r.textContent=e,r.setAttribute("for","input_"+e),r.style.display="block",r.style.marginBottom="5px",r.style.fontWeight="500",document.createElement("input"));switch(o.id="input_"+e,o.name=e,o.className="form-control",o.style.textAlign="center",t.type){case"Date":o.type="date",o.value=n||"";break;case"Number":o.type="number",o.step="0.1",o.placeholder="e.g. 175.2",o.value=n||"";break;case"Text":o.type="text",o.placeholder="Enter "+e.toLowerCase(),o.value=n||"";break;default:o.type="text",o.value=n||""}return a.appendChild(r),a.appendChild(o),u[e]=o,a})(r,o,i.data[r]||""),s.formContainer.appendChild(o))}}function c(){i.date?s.lastDate.textContent="Last updated: "+new Date(i.date).toLocaleString():s.lastDate.textContent="No previous entries"}function t(){s.auth.style.display="none",s.main.style.display="block",Promise.all([window.TrackerSheets.getColumnMetadata(),window.TrackerSheets.readLastEntry()]).then(function(e){var t=e[0];i=e[1],n(t),c()}).catch(function(e){console.error("Failed to load data:",e),o("Failed to load data: "+e.message,"error")})}function a(){if(l){var e,n={},t=!1;for(e in u){var a=u[e].value.trim();if(""!==a){var r=l.columns[e];if(!window.TrackerSheets.validateData(a,r.type))return void o("Invalid data for "+e+" (expected "+r.type+")","error");"Number"===r.type?n[e]=parseFloat(a):n[e]=a,t=!0}}t?window.TrackerSheets.appendEntry(n).then(function(e){for(var t in i={date:e.date,data:n},c(),o("Saved successfully!","success"),u)u[t].value=""}).catch(function(e){console.error("Save failed:",e),o("Save failed: "+e.message,"error")}):o("Please enter at least one value","error")}else o("Form not ready","error")}document.addEventListener("DOMContentLoaded",function(){if(s.auth=e("authSection"),s.main=e("mainSection"),s.formContainer=e("formContainer"),s.lastDate=e("lastDate"),s.save=e("saveBtn"),s.status=e("statusMessage"),!s.auth)throw new Error("Missing required element: #authSection");if(!s.main)throw new Error("Missing required element: #mainSection");if(!s.formContainer)throw new Error("Missing required element: #formContainer");if(!s.save)throw new Error("Missing required element: #saveBtn");if(!s.status)throw new Error("Missing required element: #statusMessage");s.save.addEventListener("click",a),document.addEventListener("tracker:auth:ready",t)})})();